import{Q as P}from"./QPage.5a17a53f.js";import{Q}from"./QInput.50e8e8ea.js";import{R as F,S as C,A as _,r as g,ai as k,T as j,ae as N,_ as y,C as p,M as f,F as s,E as r,aj as V,L as h,af as i,K as I,w as R,B as q,I as w,O as S,N as b,H as $,D as U}from"./index.df10e98b.js";import{u as x,Q as A}from"./use-quasar.14b813c0.js";import{Q as M,a as B}from"./QCard.0b87b1f9.js";import{Q as D}from"./QSeparator.8fa89e8e.js";import{Q as T}from"./QCardActions.84632647.js";import{Q as L}from"./QDialog.d36aee92.js";import"./use-dark.4b9f6681.js";import"./use-timeout.8f187d26.js";const H=F("settings",{state:()=>({settings:[],ipAddresses:[]}),getters:{version:e=>{const t=e.settings.filter(u=>u.name==="version");return t.length===0?"":t[0].value},domain:e=>{const t=e.settings.filter(u=>u.name==="domain");return t.length===0?"":t[0].value},port:e=>{const t=e.settings.filter(u=>u.name==="port");return t.length===0?"":t[0].value},ip:e=>e.ipAddresses.join(", ").replace('"',"")},actions:{async getSettings(){try{const e=await C.fetch("settings");e.error||(this.settings=e.result||[])}catch{}return await this.getIpAddresses(),this.settings},async getIpAddresses(){try{const e=await C.fetch("settings/ip");e.error?console.log(e.error):this.ipAddresses=e.result||[]}catch{}},async updateSettings(e){for(const t of e)await C.update("settings",{record:t});this.settings=e}}}),K=F("message",()=>{const e=x();return{error:a=>{e.notify({type:"negative",message:a,timeout:2e3})},success:a=>{e.notify({type:"positive",message:a,timeout:2e3})}}}),O=_({name:"ChangePassword",props:{isShow:{type:Boolean,default:!1}},setup(e,t){const u=g(""),a=k(()=>e.isShow),d=j(),m=N(),o=x(),n=async()=>{if(u.value==""){o.notify({type:"negative",message:"\u041F\u043E\u043B\u0435 \u043F\u0430\u0440\u043E\u043B\u044F \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C!"});return}d.changePassword(u.value).then(E=>{E?(d.logout(),m.push("/")):o.notify({type:"negative",message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043C\u0435\u043D\u044B \u043F\u0430\u0440\u043E\u043B\u044F"})}),c()},c=()=>{t.emit("close")};return{password:u,showEditor:a,onSubmit:n,closeEdit:c}}}),z={class:"q-pa-md q-gutter-sm"},G=i("div",{class:"text-h6"},"\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u0430\u0440\u043E\u043B\u044F",-1);function J(e,t,u,a,d,m){return p(),f("div",z,[s(L,{modelValue:e.showEditor,"onUpdate:modelValue":t[1]||(t[1]=o=>e.showEditor=o),persistent:""},{default:r(()=>[s(M,null,{default:r(()=>[s(B,null,{default:r(()=>[G]),_:1}),s(D),s(A,{class:"full-width",onSubmit:V(e.onSubmit,["prevent","stop"])},{default:r(()=>[s(B,{style:{"max-height":"60vh"},class:"scroll"},{default:r(()=>[s(Q,{class:"col-6 q-mb-md",outlined:"",autofocus:"",label:"\u043D\u043E\u0432\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C *",type:"password",modelValue:e.password,"onUpdate:modelValue":t[0]||(t[0]=o=>e.password=o)},null,8,["modelValue"])]),_:1}),s(D),s(T,{align:"right"},{default:r(()=>[s(h,{flat:"",label:"\u041E\u0442\u043C\u0435\u043D\u0430",color:"primary",onClick:e.closeEdit},null,8,["onClick"]),s(h,{flat:"",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}var W=y(O,[["render",J]]);const X=_({name:"SettingsComponent",components:{ChangePassword:W},setup(){const e=g(!1),t=H(),u=K();t.getSettings().then(l=>{c(l)});const a=()=>{e.value=!1},{settings:d,ip:m}=I(t),o=g([]),n=g([]),c=l=>{o.value=l.filter(v=>v.editable==="true"),n.value=l.filter(v=>v.editable==="false")};return R(d,l=>{c(l)}),{settingsEditable:o,settingsNotEditable:n,ip:m,isShowEditor:e,saveSettings:()=>{for(let l of o.value)if(l.value===""){u.error(`\u041F\u043E\u043B\u0435 '${l.label}' \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C`);return}t.updateSettings([...n.value,...o.value]).then(()=>{u.success("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B")})},closeEditor:a}}}),Y=i("h6",{class:"text-center"},"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u0442\u0430\u043D\u0446\u0438\u0438",-1),Z={class:"row flex justify-center full-width q-my-md text-bold text-uppercase"},ee=i("div",{class:"col-2",textContent:"IP \u0430\u0434\u0440\u0435\u0441\u0430"},null,-1),te=["textContent"],se=["textContent"],ue=["textContent"],oe={class:"row justify-center full-width q-my-md"};function ne(e,t,u,a,d,m){const o=q("ChangePassword");return p(),f(S,null,[Y,i("div",Z,[ee,i("div",{class:"col-5",textContent:w(e.ip)},null,8,te)]),(p(!0),f(S,null,b(e.settingsNotEditable,n=>(p(),f("div",{key:n.id,class:"row flex justify-center full-width q-my-md text-bold text-uppercase"},[i("div",{class:"col-2",textContent:w(n.label)},null,8,se),i("div",{class:"col-5",textContent:w(n.value)},null,8,ue)]))),128)),s(A,{class:"full-width",onSubmit:V(e.saveSettings,["prevent","stop"])},{default:r(()=>[(p(!0),f(S,null,b(e.settingsEditable,n=>(p(),f("div",{key:n.id,class:"row justify-center full-width q-my-md"},[s(Q,{class:"col-6",outlined:"",modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,label:n.label},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),i("div",oe,[s(h,{class:"q-ma-md",color:"primary",rounded:"",type:"submit"},{default:r(()=>[$("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")]),_:1}),s(h,{class:"q-ma-md",color:"primary",rounded:"",onClick:t[0]||(t[0]=n=>e.isShowEditor=!0)},{default:r(()=>[$("\u0421\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C")]),_:1})])]),_:1},8,["onSubmit"]),s(o,{isShow:e.isShowEditor,onClose:e.closeEditor},null,8,["isShow","onClose"])],64)}var ae=y(X,[["render",ne]]);const re=_({name:"SettingsPage",components:{SettingsComponent:ae},setup(){return{}}}),le={class:"full-width"};function ie(e,t,u,a,d,m){const o=q("SettingsComponent");return p(),U(P,{class:"flex justify-center"},{default:r(()=>[i("section",le,[s(o)])]),_:1})}var Se=y(re,[["render",ie]]);export{Se as default};
