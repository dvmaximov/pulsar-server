import{Q as A}from"./QPage.f2b63d62.js";import{Q}from"./QInput.3ab979f5.js";import{R as q,S as v,A as _,r as g,ai as P,T as k,ae as j,_ as E,C as c,M as f,F as s,E as a,aj as F,L as h,af as l,K as N,w as I,B as V,I as w,O as S,N as b,H as B,D as R}from"./index.80abe7d4.js";import{Q as x}from"./QForm.a7728971.js";import{u as U}from"./message.store.e621899a.js";import{Q as M,a as $}from"./QCard.19bfa731.js";import{Q as D}from"./QSeparator.39e6f7a2.js";import{Q as T}from"./QCardActions.d7f59fa3.js";import{Q as L}from"./QDialog.bbc8dda5.js";import{u as H}from"./use-quasar.1e946b26.js";import"./use-dark.f766abe3.js";import"./use-timeout.488bde93.js";const K=q("settings",{state:()=>({settings:[],ipAddresses:[]}),getters:{version:e=>{const t=e.settings.filter(u=>u.name==="version");return t.length===0?"":t[0].value},domain:e=>{const t=e.settings.filter(u=>u.name==="domain");return t.length===0?"":t[0].value},port:e=>{const t=e.settings.filter(u=>u.name==="port");return t.length===0?"":t[0].value},ip:e=>e.ipAddresses.join(", ").replace('"',"")},actions:{async getSettings(){try{const e=await v.fetch("settings");e.error||(this.settings=e.result||[])}catch{}return await this.getIpAddresses(),this.settings},async getIpAddresses(){try{const e=await v.fetch("settings/ip");e.error?console.log(e.error):this.ipAddresses=e.result||[]}catch{}},async updateSettings(e){for(const t of e)await v.update("settings",{record:t});this.settings=e}}}),O=_({name:"ChangePassword",props:{isShow:{type:Boolean,default:!1}},setup(e,t){const u=g(""),p=P(()=>e.isShow),i=k(),m=j(),o=H(),n=async()=>{if(u.value==""){o.notify({type:"negative",message:"\u041F\u043E\u043B\u0435 \u043F\u0430\u0440\u043E\u043B\u044F \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C!"});return}i.changePassword(u.value).then(y=>{y?(i.logout(),m.push("/")):o.notify({type:"negative",message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043C\u0435\u043D\u044B \u043F\u0430\u0440\u043E\u043B\u044F"})}),d()},d=()=>{t.emit("close")};return{password:u,showEditor:p,onSubmit:n,closeEdit:d}}}),z={class:"q-pa-md q-gutter-sm"},G=l("div",{class:"text-h6"},"\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u0430\u0440\u043E\u043B\u044F",-1);function J(e,t,u,p,i,m){return c(),f("div",z,[s(L,{modelValue:e.showEditor,"onUpdate:modelValue":t[1]||(t[1]=o=>e.showEditor=o),persistent:""},{default:a(()=>[s(M,null,{default:a(()=>[s($,null,{default:a(()=>[G]),_:1}),s(D),s(x,{class:"full-width",onSubmit:F(e.onSubmit,["prevent","stop"])},{default:a(()=>[s($,{style:{"max-height":"60vh"},class:"scroll"},{default:a(()=>[s(Q,{class:"col-6 q-mb-md",outlined:"",autofocus:"",label:"\u043D\u043E\u0432\u044B\u0439 \u043F\u0430\u0440\u043E\u043B\u044C *",type:"password",modelValue:e.password,"onUpdate:modelValue":t[0]||(t[0]=o=>e.password=o)},null,8,["modelValue"])]),_:1}),s(D),s(T,{align:"right"},{default:a(()=>[s(h,{flat:"",label:"\u041E\u0442\u043C\u0435\u043D\u0430",color:"primary",onClick:e.closeEdit},null,8,["onClick"]),s(h,{flat:"",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}var W=E(O,[["render",J]]);const X=_({name:"SettingsComponent",components:{ChangePassword:W},setup(){const e=g(!1),t=K(),u=U();t.getSettings().then(r=>{d(r)});const p=()=>{e.value=!1},{settings:i,ip:m}=N(t),o=g([]),n=g([]),d=r=>{o.value=r.filter(C=>C.editable==="true"),n.value=r.filter(C=>C.editable==="false")};return I(i,r=>{d(r)}),{settingsEditable:o,settingsNotEditable:n,ip:m,isShowEditor:e,saveSettings:()=>{for(let r of o.value)if(r.value===""){u.error(`\u041F\u043E\u043B\u0435 '${r.label}' \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C`);return}t.updateSettings([...n.value,...o.value]).then(()=>{u.success("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B")})},closeEditor:p}}}),Y=l("h6",{class:"text-center"},"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u0442\u0430\u043D\u0446\u0438\u0438",-1),Z={class:"row flex justify-center full-width q-my-md text-bold text-uppercase"},ee=l("div",{class:"col-2",textContent:"IP \u0430\u0434\u0440\u0435\u0441\u0430"},null,-1),te=["textContent"],se=["textContent"],ue=["textContent"],oe={class:"row justify-center full-width q-my-md"};function ne(e,t,u,p,i,m){const o=V("ChangePassword");return c(),f(S,null,[Y,l("div",Z,[ee,l("div",{class:"col-5",textContent:w(e.ip)},null,8,te)]),(c(!0),f(S,null,b(e.settingsNotEditable,n=>(c(),f("div",{key:n.id,class:"row flex justify-center full-width q-my-md text-bold text-uppercase"},[l("div",{class:"col-2",textContent:w(n.label)},null,8,se),l("div",{class:"col-5",textContent:w(n.value)},null,8,ue)]))),128)),s(x,{class:"full-width",onSubmit:F(e.saveSettings,["prevent","stop"])},{default:a(()=>[(c(!0),f(S,null,b(e.settingsEditable,n=>(c(),f("div",{key:n.id,class:"row justify-center full-width q-my-md"},[s(Q,{class:"col-6",outlined:"",modelValue:n.value,"onUpdate:modelValue":d=>n.value=d,label:n.label},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),l("div",oe,[s(h,{class:"q-ma-md",color:"primary",rounded:"",type:"submit"},{default:a(()=>[B("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")]),_:1}),s(h,{class:"q-ma-md",color:"primary",rounded:"",onClick:t[0]||(t[0]=n=>e.isShowEditor=!0)},{default:a(()=>[B("\u0421\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C")]),_:1})])]),_:1},8,["onSubmit"]),s(o,{isShow:e.isShowEditor,onClose:e.closeEditor},null,8,["isShow","onClose"])],64)}var ae=E(X,[["render",ne]]);const re=_({name:"SettingsPage",components:{SettingsComponent:ae},setup(){return{}}}),le={class:"full-width"};function ie(e,t,u,p,i,m){const o=V("SettingsComponent");return c(),R(A,{class:"flex justify-center"},{default:a(()=>[l("section",le,[s(o)])]),_:1})}var Ee=E(re,[["render",ie]]);export{Ee as default};
